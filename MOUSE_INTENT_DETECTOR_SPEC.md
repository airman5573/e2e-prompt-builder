# 마우스 의도 감지 모듈 개발 명세서

## 1. 배경 및 문제점

### 현재 상황
- 모달이 열린 후 마우스를 280px 이상 이동하면 자동으로 모달이 닫힘 (ESC 효과)
- 문제: 사용자가 모달 내부의 "복사하기" 버튼으로 마우스를 이동하는 도중에도 모달이 닫혀버림

### 해결 목표
사용자의 **의도**를 정확히 파악하여:
- 모달 내부 버튼으로 이동 중인 경우: 모달 유지
- 모달에서 벗어나려는 의도가 명확한 경우: 모달 자동 닫기

## 2. 기능 요구사항

### 2.1 핵심 기능
독립적인 JavaScript 모듈로 마우스 이동을 분석하여 "모달을 닫아야 하는지" 판단하는 로직 제공

### 2.2 판단 기준 (다중 조건 조합)

#### 조건 1: 모달 요소 호버 감지
- 현재 마우스가 모달 element 위에 있으면 **절대 닫지 않음**
- 모달의 자식 요소(버튼, textarea 등) 위에 있어도 마찬가지

#### 조건 2: 총 이동 거리
- 모달이 열린 시점의 마우스 위치에서 현재 위치까지의 직선 거리
- 거리 임계값: 280px (설정 가능해야 함)
- 280px 미만이면 닫지 않음

#### 조건 3: 이동 속도 감지
- 마우스가 빠르게 움직이는지 판단
- 속도 임계값: 50px/frame (설정 가능해야 함)
- 빠른 이동 = "급하게 벗어나려는 의도"

#### 조건 4: 방향 분석
- 마우스 이동 방향이 모달을 향하는지, 반대 방향인지 판단
- 벡터 내적(dot product)을 활용한 방향 계산
- 모달 중심점을 기준으로 분석

### 2.3 최종 판단 로직
다음 조건 중 하나라도 만족하면 모달 닫기:
1. **빠른 이동**: 속도 > 50px/frame AND 총 거리 > 280px
2. **반대 방향 이동**: 모달 반대 방향으로 이동 AND 총 거리 > 280px

다음 조건이면 모달 유지:
1. 모달 요소에 마우스 호버 중
2. 총 거리 < 280px
3. 모달을 향해 이동 중

## 3. 기술 요구사항

### 3.1 파일 정보
- **파일명**: `mouseIntentDetector.js`
- **위치**: 프로젝트 루트 (`/Users/yoon/Desktop/element-id-copy-chrome-extension-sonnet-to-codex/`)
- **형식**: ES6 모듈 (export 사용)

### 3.2 제약사항
- 외부 라이브러리 의존성 없음 (순수 JavaScript)
- contentScript.js와 독립적으로 개발 (현재 contentScript.js는 다른 개발자가 수정 중)
- 브라우저 호환성: Chrome Extension Manifest V3 환경

### 3.3 API 요구사항
모듈은 다음 기능을 제공해야 함:

#### 필수 메서드
1. **초기화/설정**: 거리 임계값, 속도 임계값 등 설정 가능
2. **추적 시작**: 모달 element와 초기 마우스 위치를 받아 추적 시작
3. **이동 감지**: 마우스 이동 이벤트를 받아 "닫아야 하는지" 판단 결과 반환
4. **추적 종료**: 상태 초기화

#### 반환 형식
각 마우스 이동 시마다 다음 정보 반환:
- 모달을 닫아야 하는지 (boolean)
- 판단 근거/이유 (디버깅용 문자열, 예: "fast move", "opposite direction", "hovering modal" 등)

### 3.4 문서화
- JSDoc 주석으로 모든 public 메서드 설명
- 사용 예시 코드 포함

## 4. 테스트 시나리오

### 시나리오 A: 복사하기 버튼 클릭 ✅
1. 모달 열림
2. 마우스를 천천히 "복사하기" 버튼으로 이동 (100px 정도)
3. **예상 결과**: 모달 유지됨
4. **이유**: 버튼 호버 OR 거리 < 280px OR 모달 향함

### 시나리오 B: 웹페이지로 빠르게 이동 ❌
1. 모달 열림
2. 마우스를 빠르게 페이지 다른 곳으로 이동 (500px)
3. **예상 결과**: 모달 자동 닫힘
4. **이유**: 빠른 이동 + 거리 > 280px

### 시나리오 C: 모달 밖으로 천천히 멀리 이동 ❌
1. 모달 열림
2. 마우스를 천천히 아래쪽으로 이동 (300px)
3. 방향은 모달 반대 방향
4. **예상 결과**: 모달 자동 닫힘
5. **이유**: 반대 방향 + 거리 > 280px

### 시나리오 D: 모달 근처에서 망설임 ✅
1. 모달 열림
2. 마우스를 여기저기 이동하지만 200px 이내
3. **예상 결과**: 모달 유지됨
4. **이유**: 거리 < 280px

### 시나리오 E: 버튼으로 향하다가 방향 전환 ❌
1. 모달 열림
2. 마우스를 버튼 쪽으로 이동하다가 갑자기 반대쪽으로 빠르게 이동 (400px)
3. **예상 결과**: 모달 자동 닫힘
4. **이유**: 빠른 이동 + 거리 > 280px

## 5. 개발 가이드

### 5.1 좌표 계산
- `event.clientX`, `event.clientY` 사용
- 거리 계산: 피타고라스 정리 (`Math.sqrt(dx*dx + dy*dy)`)

### 5.2 모달 영역 계산
- `element.getBoundingClientRect()` 사용
- 모달 중심점 계산 필요

### 5.3 방향 벡터
- 이동 벡터: 현재 위치 - 이전 위치
- 모달 향하는 벡터: 모달 중심 - 현재 위치
- 내적(dot product)으로 같은 방향인지 판단

### 5.4 호버 감지
- `event.target` 사용
- `element.contains(target)` 또는 `target.closest()` 활용 가능

## 6. 제출물

1. `mouseIntentDetector.js` 파일
2. 코드 내 JSDoc 주석
3. 간단한 사용 예시 (주석 또는 별도 파일)

## 7. 향후 통합 계획 (참고용)

이 모듈은 나중에 `contentScript.js`의 `handleModalMouseMove()` 함수를 대체할 예정입니다.
현재는 **독립적으로 동작 가능한 모듈**만 개발해주세요.
통합 작업은 별도 개발자가 진행합니다.

---

**작성일**: 2025-10-16
**작성자**: PM Claude
